{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'accounts/css/profile_edit.css' %}">

<div class="row justify-content-center">
    <div class="col-md-8">
        
        <div class="dashboard-card mb-4 border-0 shadow-lg overflow-hidden" style="height: auto;">
            <div style="height: 100px; background: var(--brand-gradient);"></div>
            
            <div class="card-body text-center px-4 pb-4 position-relative">
                
                <div class="position-relative d-inline-block" style="margin-top: -60px; margin-bottom: 1rem;">
                    {% if target_user.profile_image and not target_user.hide_profile_image or target_user.profile_image and request.user == target_user %}
                        <img src="{{ target_user.profile_image.url }}" 
                             class="rounded-circle shadow border border-4 border-white bg-white" 
                             style="width: 120px; height: 120px; object-fit: cover;">
                    {% else %}
                        <div class="rounded-circle bg-light d-flex align-items-center justify-content-center shadow border border-4 border-white mx-auto" 
                             style="width: 120px; height: 120px;">
                            <span style="font-size: 3rem;">üë§</span>
                        </div>
                    {% endif %}
                </div>
                
                <div class="d-flex align-items-center justify-content-center gap-2 mb-1">
                    <h3 class="fw-bold text-dark mb-0">{{ target_user.username }}</h3>
                    <span class="badge rounded-pill border-0 shadow-sm px-3 py-1 mt-1" 
                          style="background: linear-gradient(135deg, #42e695 0%, #3bb2b8 100%); font-size: 0.85rem;">
                        Lv.{{ target_user.level }}
                    </span>
                </div>
                
                <div class="d-flex justify-content-center gap-2 mb-3 flex-wrap">
                    {% if target_user.height %}
                        <span class="badge bg-light text-secondary border rounded-pill px-3">
                            Height: {{ target_user.height }} cm
                        </span>
                    {% endif %}
                    {% if target_user.target_weight %}
                        <span class="badge bg-light text-secondary border rounded-pill px-3">
                            Goal: {{ target_user.target_weight }} kg
                            {% if to_target is not None %}
                                <span class="ms-1 {% if to_target > 0 %}text-danger{% else %}text-success{% endif %}">
                                    ({% if to_target > 0 %}+{% endif %}{{ to_target }} kg)
                                </span>
                            {% endif %}
                        </span>
                    {% endif %}
                </div>

                {% if target_user.introduction %}
                    <p class="text-muted mx-auto mb-4 small" style="max-width: 500px; line-height: 1.6;">
                        {{ target_user.introduction|linebreaksbr }}
                    </p>
                {% else %}
                    <p class="text-muted small mb-4 opacity-50">Ëá™Â∑±Á¥π‰ªã„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                {% endif %}

                <div class="d-flex justify-content-center gap-2 gap-md-4 mb-3">
                    <a href="{% url 'accounts:follow_list' target_user.id 'following' %}" class="text-decoration-none text-dark">
                        <div class="px-3 py-2 rounded-3 hover-bg-light transition-all">
                            <span class="fw-bold fs-5 d-block">{{ following_count }}</span>
                            <span class="text-muted small fw-bold">„Éï„Ç©„É≠„Éº</span>
                        </div>
                    </a>
                    
                    <a href="{% url 'accounts:follow_list' target_user.id 'followers' %}" class="text-decoration-none text-dark">
                        <div class="px-3 py-2 rounded-3 hover-bg-light transition-all">
                            <span class="fw-bold fs-5 d-block">{{ follower_count }}</span>
                            <span class="text-muted small fw-bold">„Éï„Ç©„É≠„ÉØ„Éº</span>
                        </div>
                    </a>

                    <div class="px-3 py-2 rounded-3 bg-pink-light">
                        <span class="fw-bold fs-5 d-block text-danger">
                            <i class="bi bi-heart-fill small me-1"></i>{{ total_likes }}
                        </span>
                        <span class="text-muted small fw-bold">Total Likes</span>
                    </div>
                </div>

                <div class="d-flex justify-content-center">
                    {% if request.user == target_user %}
                        <a href="{% url 'accounts:profile_edit' %}" class="btn btn-outline-secondary rounded-pill px-4 fw-bold">
                            <i class="bi bi-gear-fill me-1"></i> „Éó„É≠„Éï„Ç£„Éº„É´Á∑®ÈõÜ
                        </a>
                    {% else %}
                        {% if is_following %}
                            <a href="{% url 'accounts:unfollow' target_user.id %}" class="btn btn-outline-danger rounded-pill px-4 fw-bold">
                                „Éï„Ç©„É≠„ÉºËß£Èô§
                            </a>
                        {% else %}
                            <a href="{% url 'accounts:follow' target_user.id %}" class="btn btn-gradient rounded-pill px-5">
                                „Éï„Ç©„É≠„Éº„Åô„Çã
                            </a>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="row g-3 mb-4">
            
            <div class="col-6 {% if request.user == target_user %}col-md-3{% else %}col-md-6{% endif %}">
                <div class="dashboard-card p-3 text-center h-100 d-flex flex-column justify-content-center">
                    <small class="text-muted d-block mb-1 fw-bold" style="font-size: 0.7rem;">STARTED</small>
                    <div class="fw-bold text-dark fs-5">{{ days_since_joined }} <span class="fs-6 text-muted">Days</span></div>
                </div>
            </div>

            <div class="col-6 {% if request.user == target_user %}col-md-3{% else %}col-md-6{% endif %}">
                <div class="dashboard-card p-3 text-center h-100 d-flex flex-column justify-content-center">
                    <small class="text-muted d-block mb-1 fw-bold" style="font-size: 0.7rem;">RECORDS</small>
                    <div class="fw-bold text-success fs-5">{{ total_records }} <span class="fs-6 text-muted">Times</span></div>
                </div>
            </div>

            {% if request.user == target_user %}
                <div class="col-6 col-md-3">
                    <div class="dashboard-card p-3 text-center h-100 d-flex flex-column justify-content-center">
                        <small class="text-muted d-block mb-1 fw-bold" style="font-size: 0.7rem;">START WEIGHT</small>
                        <div class="fw-bold text-dark fs-5">{{ initial_weight|default:"--" }} <span class="fs-6 text-muted">kg</span></div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="dashboard-card p-3 text-center h-100 d-flex flex-column justify-content-center">
                        <small class="text-muted d-block mb-1 fw-bold" style="font-size: 0.7rem;">CHANGE</small>
                        <div class="fw-bold fs-5 {% if weight_diff < 0 %}text-success{% elif weight_diff > 0 %}text-danger{% endif %}">
                            {% if weight_diff is not None %}
                                {% if weight_diff > 0 %}+{% endif %}{{ weight_diff }}
                            {% else %}
                                --
                            {% endif %}
                            <span class="fs-6 text-muted">kg</span>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>

        <div class="dashboard-card border-0 p-3 d-flex justify-content-between align-items-center mb-3" 
             style="background: linear-gradient(to right, #f0fff4, #fff); height: auto;">
            <div class="d-flex align-items-center gap-3">
                <div class="rounded-circle bg-white shadow-sm d-flex align-items-center justify-content-center text-success" 
                     style="width: 50px; height: 50px; font-size: 1.5rem;">
                    üèÜ
                </div>
                <div>
                    <h6 class="fw-bold mb-0 text-success">TOTAL CLEARED</h6>
                    <small class="text-muted">Á∑è„ÇØ„É™„Ç¢„Éü„ÉÉ„Ç∑„Éß„É≥Êï∞</small>
                </div>
            </div>
            <div class="text-end">
                <div class="d-flex align-items-baseline justify-content-end">
                    <span class="display-6 fw-bold text-dark lh-1">{{ target_user.total_missions_cleared }}</span>
                    <span class="text-muted small fw-bold text-end" style="min-width: 70px;">Missions</span>
                </div>
            </div>
        </div>

        <div class="dashboard-card border-0 p-3 d-flex justify-content-between align-items-center" 
             style="background: linear-gradient(to right, #fff5f5, #fff); height: auto;">
            <div class="d-flex align-items-center gap-3">
                <div class="rounded-circle bg-white shadow-sm d-flex align-items-center justify-content-center text-danger" 
                     style="width: 50px; height: 50px; font-size: 1.5rem;">
                    üî•
                </div>
                <div>
                    <h6 class="fw-bold mb-0 text-danger">MISSION MASTER</h6>
                    <small class="text-muted">3„Å§ÂÖ®„Å¶„ÇØ„É™„Ç¢„Åó„ÅüÊó•Êï∞</small>
                </div>
            </div>
            <div class="text-end">
                <div class="d-flex align-items-baseline justify-content-end">
                    <span class="display-6 fw-bold text-dark lh-1">{{ perfect_mission_days }}</span>
                    <span class="text-muted small fw-bold text-end" style="min-width: 70px;">Days</span>
                </div>
            </div>
        </div>

    </div>
</div>

<style>
    .hover-bg-light:hover {
        background-color: #f8f9fa;
    }
    .transition-all {
        transition: all 0.2s;
    }
    .bg-pink-light {
        background-color: #fff5f5;
    }

</style>
{% endblock %}